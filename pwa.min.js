var appPublicKey="BOFEuDq6bxn2j-157kGVPNcSTwwgNTkiQBGzeOUuv05OZ-Evf7itnsdTixcQVW9lEnqd12Rxeix3UIlktJebwYs",messaging;"undefined"!=typeof firebase&&(console.log("const messaging = firebase.messaging();"),messaging=firebase.messaging(),messaging.usePublicVapidKey(appPublicKey));function urlBase64ToUint8Array(a){var b="=".repeat((4-a.length%4)%4);a=(a+b).replace(/\-/g,"+").replace(/_/g,"/");a=window.atob(a);b=new Uint8Array(a.length);for(var c=0;c<a.length;++c)b[c]=a.charCodeAt(c);return b}
function initialiseState(){"showNotification"in ServiceWorkerRegistration.prototype?"denied"===Notification.permission?console.log("The user has blocked notifications."):"PushManager"in window?"undefined"==typeof firebase?console.log("Firebase is not defined"):navigator.serviceWorker.ready.then(function(a){messaging.useServiceWorker(a);a.pushManager.getSubscription().then(function(a){a||("/UserRegistrationForm"==window.location.pathname||"/Account"==window.location.pathname||"/confirma-tu-registro-en-coppel"==
window.location.pathname||"/OrderShippingBillingConfirmationView"==window.location.pathname)&&setTimeout(function(){enablePushUI()},2E3)})["catch"](function(a){console.log("Error during getSubscription()",a)})}):console.log("Push messaging isn't supported."):console.log("Notifications aren't supported.")}
function enablePushUI(){var a=parseInt(localStorage.getItem("pushCancelled"));if(null==a||isNaN(a))$(".pushNotificationsInOpt").css("display","block"),$(".pushNotificationsInOpt").is(":visible")&&dataLayer.push({nd1:"Recibir notificaciones",nd2:"Aviso",nd3:"Visualizaci\u00f3n",nd4:"",event:"clicGeneral"})}function disabledPushUI(){$(".pushNotificationsInOpt").css("display","none")}
function fcmSubscribe(){dataLayer.push({nd1:"Recibir notificaciones",nd2:"Permisos",nd3:"Visualizaci\u00f3n",nd4:"",event:"clicGeneral"});messaging.requestPermission().then(function(){console.log("Notification permission granted.");messaging.getToken().then(function(a){a?sendSubscriptionToServer(a):console.log("No Instance ID token available. Request permission to generate one.")})["catch"](function(a){console.log("An error occurred while retrieving token. ",a)})})["catch"](function(a){dataLayer.push({nd1:"Recibir notificaciones",
nd2:"Permisos",nd3:"Bloquear",nd4:"",event:"clicGeneral"});console.log("Unable to get permission to notify.",a)})}
function sendSubscriptionToServer(a){$.ajax({type:"POST",url:"https://iid.googleapis.com/iid/v1/"+a+"/rel/topics/General",headers:{"Content-Type":"application/json",Authorization:"key=AIzaSyAzE5cEfz2XOR_MfABfjzoJHH8n5pK7mww"},success:function(a){console.log("Subscription sent to server");dataLayer.push({nd1:"Recibir notificaciones",nd2:"Permisos",nd3:"Permitir",nd4:"",event:"clicGeneral"})},error:function(a){console.log("Error: "+a)}})}
if("serviceWorker"in navigator){var sw_name;sw_name="www.coppel.com"==window.location.hostname?"service-worker.js":"service-worker-dev.js";navigator.serviceWorker.register(sw_name).then(function(a){console.log("ServiceWorker registration successful with scope: ",a.scope);initialiseState()},function(a){console.log("ServiceWorker registration failed: ",a)})}var installed=!0;
$("#pushAccept").bind("click",function(){dataLayer.push({nd1:"Recibir notificaciones",nd2:"Aviso",nd3:"Suscribirme",nd4:"",event:"clicGeneral"});fcmSubscribe();$(".pushNotificationsInOpt").css("display","none")});$("#pushCancel").bind("click",function(){dataLayer.push({nd1:"Recibir notificaciones",nd2:"Aviso",nd3:"Ahora no",nd4:"",event:"clicGeneral"});$(".pushNotificationsInOpt").css("display","none");localStorage.setItem("pushCancelled",1)});
$("#closeMshPush").bind("click",function(){dataLayer.push({nd1:"Recibir notificaciones",nd2:"Aviso",nd3:"Ahora no",nd4:"",event:"clicGeneral"});$(".pushNotificationsInOpt").css("display","none");localStorage.setItem("pushCancelled",1)});var deferredPrompt;
window.addEventListener("beforeinstallprompt",function(a){a.preventDefault();deferredPrompt=a;installed=!1;a=window.location.pathname;var b=parseInt(localStorage.getItem("visitasHome"));if(null==b||isNaN(b))localStorage.setItem("visitasHome",1),b=1;"/"==a&&(b++,localStorage.setItem("visitasHome",b),3<=b&&0==installed&&showInstallPrompt())});var prompt=document.getElementById("prompt");
$("#btnAdd").on("click",function(a){prompt.style.display="none";dataLayer.push({nd1:"Add to homescreen",nd2:"Instalar",nd3:"",nd4:"",event:"clicGeneral"});deferredPrompt.prompt();dataLayer.push({nd1:"Add to homescreen",nd2:"Instalaci\u00f3n",nd3:"Mostrar",nd4:"",event:"clicGeneral"});deferredPrompt.userChoice.then(function(a){"dismissed"===a.outcome?(disableA2HS(),dataLayer.push({nd1:"Add to homescreen",nd2:"Instalaci\u00f3n",nd3:"Cancelar",nd4:"",event:"clicGeneral"})):(disableA2HS(),dataLayer.push({nd1:"Add to homescreen",
nd2:"Instalaci\u00f3n",nd3:"Aceptar",nd4:"",event:"clicGeneral"}));deferredPrompt=null})});$(".btnNotInstall").on("click",function(a){prompt.style.display="none";disableA2HS();dataLayer.push({nd1:"Add to homescreen",nd2:"Dismiss",nd3:"",nd4:"",event:"clicGeneral"})});
if(window.matchMedia("(display-mode: standalone)").matches){disableA2HS();console.log(" standalone homescreen ");var urlWeb=window.location,objUrl=new URL(urlWeb),utmSource=objUrl.searchParams.get("utm_source"),utmMedium=objUrl.searchParams.get("utm_medium");utmSource&&"homescreen"!=utmSource&&utmMedium&&"PWA"!=utmMedium&&dataLayer.push({nd1:"Homescreen",nd2:"Apertura",nd3:"",nd4:"",event:"clicGeneral"});var noddy,remotes=!1;document.addEventListener("click",function(a){for(noddy=a.target;"A"!==noddy.nodeName&&
"HTML"!==noddy.nodeName;)noddy=noddy.parentNode;"href"in noddy&&-1!==noddy.href.indexOf("http")&&(-1!==noddy.href.indexOf(document.location.host)||remotes)&&(a.preventDefault(),document.location.href=noddy.href)},!1)}function disableA2HS(){localStorage.setItem("disableA2HS",!0)}
function showInstallPrompt(){null==localStorage.getItem("disableA2HS")&&($("#prompt").show(),$(".prompt").is(":visible")&&dataLayer.push({nd1:"Add to homescreen",nd2:"Visualizaci\u00f3n",nd3:"",nd4:"",event:"clicGeneral"}))};